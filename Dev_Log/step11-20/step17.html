<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TelpCamp 開発記録 - Step 17: 編集フォームへのバリデーション適用</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }

        h1,
        h2,
        h3,
        h4 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        h4 {
            border-bottom: none;
            color: #3498db;
        }

        code {
            background-color: #ecf0f1;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        }

        pre {
            background-color: #2c3e50;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        .step {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .concept {
            background-color: #e8f6f3;
            border-left: 5px solid #1abc9c;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>

<body>

    <h1>TelpCamp プロジェクト作成の記録</h1>

    <div class="step">
        <h2>Step 17: 編集フォームへのクライアントサイドバリデーション適用</h2>
        <p>
            今回は、前回新規登録フォーム（<code>new.ejs</code>）に実装したクライアントサイドバリデーションを、キャンプ場編集フォーム（<code>edit.ejs</code>）にも適用しました。
        </p>
        <p>
            これにより、新規登録時だけでなく編集時にも、ユーザーが必須項目を空欄のまま送信してしまうのを防ぎ、より一貫性のある使いやすいアプリケーションになりました。
        </p>

        <h3>実装: 編集フォームのHTML修正 (`edit.ejs`)</h3>
        <p>
            前回の実装で、バリデーションを実行するJavaScriptは共通レイアウトファイル（<code>boilerplate.ejs</code>）に記述済みです。そのため、<code>edit.ejs</code>のHTMLを修正するだけで、同じバリデーション機能を有効にすることができます。
        </p>
        <pre><code class="language-html">&lt;% layout('layouts/boilerplate') %&gt;

&lt;div class="row"&gt;
    &lt;h1 class="text-center"&gt;キャンプ場を編集&lt;/h1&gt;
    &lt;div class="col-6 offset-3"&gt;
        &lt;!-- 変更点1: novalidateとneeds-validationクラスを追加 --&gt;
        &lt;form action="/campgrounds/&lt;%= campground._id %&gt;?_method=PUT" method="POST" novalidate class="needs-validation"&gt;
            &lt;div class="mb-3"&gt;
                &lt;label class="form-label" for="name"&gt;キャンプ場名&lt;/label&gt;
                &lt;!-- 変更点2: required属性を追加 --&gt;
                &lt;input class="form-control" type="text" id="name" name="campground[name]" value="&lt;%= campground.name %&gt;" required&gt;
                &lt;!-- 変更点3: バリデーションメッセージ用のdivを追加 --&gt;
                &lt;div class="invalid-feedback"&gt;
                    キャンプ場名を入力してください。
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;!-- ... 他の入力項目も同様に required と invalid-feedback を追加 ... --&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
        <h4>主な変更点:</h4>
        <p><code>new.ejs</code>に行った修正とほぼ同じです。</p>
        <ul>
            <li><strong><code>&lt;form&gt;</code>タグ</strong>:
                <code>novalidate</code>属性と<code>class="needs-validation"</code>を追加しました。</li>
            <li><strong><code>&lt;input&gt;</code>, <code>&lt;textarea&gt;</code>タグ</strong>:
                <code>required</code>属性を追加しました。</li>
            <li><strong>エラーメッセージ用<code>&lt;div&gt;</code></strong>:
                各項目に<code>invalid-feedback</code>を追加しました。（<code>valid-feedback</code>も同様です）</li>
        </ul>

        <div class="concept">
            <h4>💡 コードの再利用性とDRY原則</h4>
            <p>
                今回の実装では、新しいJavaScriptコードを一行も書く必要がありませんでした。これは、バリデーションのロジックを共通のレイアウトファイル<code>boilerplate.ejs</code>に記述しておいたおかげです。
            </p>
            <p>
                このように、同じ機能やコードを複数の場所で繰り返し書くのではなく、一箇所にまとめて再利用する考え方を<strong>DRY (Don't Repeat Yourself)
                    原則</strong>と呼びます。DRY原則に従うことで、コードが簡潔になり、将来の修正や機能追加が容易になるという大きなメリットがあります。もしバリデーションの挙動を変更したくなった場合でも、<code>boilerplate.ejs</code>のスクリプトを修正するだけで、このアプリケーションの全てのフォームに一括で変更を適用できます。
            </p>
        </div>
    </div>

</body>

</html>