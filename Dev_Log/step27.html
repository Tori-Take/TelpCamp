<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TelpCamp é–‹ç™ºè¨˜éŒ² - Step 27: ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å®Ÿè£…</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }

        h1,
        h2,
        h3,
        h4 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px
        }

        h4 {
            border-bottom: none;
            color: #3498db;
        }

        code {
            background-color: #ecf0f1;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        }

        pre {
            background-color: #2c3e50;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        .step {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .concept {
            background-color: #eafaf1;
            border-left: 5px solid #2ecc71;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>

<body>

    <h1>TelpCamp ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã®è¨˜éŒ²</h1>

    <div class="step">
        <h2>Step 27: ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å®Ÿè£…</h2>
        <p>
            ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚­ãƒ£ãƒ³ãƒ—å ´ã®ä½œæˆãªã©ã®æ“ä½œã‚’è¡Œã£ãŸå¾Œã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’æŒŸã‚“ã§ã€Œä½œæˆã—ã¾ã—ãŸã€ã¨ã„ã£ãŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã€Œãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚
            ã“ã®æ©Ÿèƒ½ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ã¦ãŠã‚Šã€ä¸€åº¦è¡¨ç¤ºã•ã‚Œã‚‹ã¨æ¶ˆãˆã‚‹ä¸€æ™‚çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ã€‚
        </p>

        <h3>å­¦ç¿’ã®ç›®çš„</h3>
        <ul>
            <li><code>connect-flash</code>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã„ã€ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•ã‚’å­¦ã¶ã€‚</li>
            <li><code>req.flash('key', 'message')</code>ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®šã—ã€<code>req.flash('key')</code>ã§å–ã‚Šå‡ºã™ä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹ã€‚</li>
            <li><code>res.locals</code>ã¨ã‚«ã‚¹ã‚¿ãƒ ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’çµ„ã¿åˆã‚ã›ã€ã™ã¹ã¦ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§å…±é€šã®å¤‰æ•°ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹æ–¹æ³•ã‚’å­¦ã¶ã€‚</li>
            <li>EJSã®ãƒ‘ãƒ¼ã‚·ãƒ£ãƒ«ï¼ˆéƒ¨åˆ†ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰æ©Ÿèƒ½ã‚’ä½¿ã„ã€UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å†åˆ©ç”¨å¯èƒ½ãªå½¢ã§ç®¡ç†ã™ã‚‹æ–¹æ³•ã‚’å®Ÿè·µã™ã‚‹ã€‚</li>
        </ul>
    </div>

    <div class="step">
        <h2>å®Ÿè£…ã®è§£èª¬</h2>
        <p>
            å®Ÿè£…ã¯ã€ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®è¨­å®šã€ãƒ«ãƒ¼ãƒˆã§ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨­å®šã€ãƒ“ãƒ¥ãƒ¼ã§ã®è¡¨ç¤ºã¨ã„ã†3æ®µéšã§è¡Œã„ã¾ã—ãŸã€‚
        </p>
        <ol>
            <li>
                <h4>1. ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®è¨­å®š (<code>index.js</code>)</h4>
                <p>
                    ã¾ãš<code>npm install connect-flash</code>ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€<code>index.js</code>ã§ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã—ãŸã€‚
                    ç‰¹ã«é‡è¦ãªã®ã¯ã€ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¤‰æ•°ã¨ã—ã¦ãƒ“ãƒ¥ãƒ¼ã«æ¸¡ã™ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ã™ã€‚
                </p>
                <pre><code class="language-javascript">// index.js
const flash = require('connect-flash');
// ...
app.use(session(sessionConfig));
app.use(flash()); // sessionãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®å¾Œã«è¨­å®š

// ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ“ãƒ¥ãƒ¼ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
app.use((req, res, next) => {
    res.locals.success = req.flash('success');
    res.locals.error = req.flash('error');
    next();
});</code></pre>
                <div class="concept">
                    <h4>ğŸ’¡ <code>res.locals</code>ã«ã‚ˆã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°</h4>
                    <p>
                        <code>res.locals</code>ã¯ã€ãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚µã‚¤ã‚¯ãƒ«ä¸­ã ã‘å­˜åœ¨ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚ã“ã“ã«æ ¼ç´ã•ã‚ŒãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆä¾‹:
                        <code>res.locals.success</code>ï¼‰ã¯ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹EJSãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ï¼ˆä¾‹:
                        <code>success</code>ï¼‰ã®ã‚ˆã†ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
                        ã“ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®ãŠã‹ã’ã§ã€ã©ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ã§ã‚‚<code>success</code>ã‚„<code>error</code>ã¨ã„ã£ãŸå¤‰æ•°ã‚’å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
                    </p>
                </div>
            </li>
            <li>
                <h4>2. ãƒ«ãƒ¼ãƒˆã§ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨­å®š (<code>routes/campgrounds.js</code>)</h4>
                <p>
                    ã‚­ãƒ£ãƒ³ãƒ—å ´ãŒæ­£å¸¸ã«ä½œæˆã•ã‚ŒãŸå¾Œã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ç›´å‰ã«<code>req.flash()</code>ã‚’ä½¿ã£ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜ã—ã¾ã™ã€‚
                </p>
                <pre><code class="language-javascript">// routes/campgrounds.js ã®Createãƒ«ãƒ¼ãƒˆ
router.post('/', validateCampground, wrapAsync(async (req, res) => {
    const campground = new Campground(req.body.campground);
    await campground.save();
    req.flash('success', 'æ–°ã—ã„ã‚­ãƒ£ãƒ³ãƒ—å ´ã‚’ä½œæˆã—ã¾ã—ãŸã€‚'); // ã“ã“ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®š
    res.redirect(`/campgrounds/${campground._id}`);
}));</code></pre>
            </li>
            <li>
                <h4>3. ãƒ“ãƒ¥ãƒ¼ã§ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º</h4>
                <p>
                    ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºéƒ¨åˆ†ã‚’å†åˆ©ç”¨å¯èƒ½ãªãƒ‘ãƒ¼ã‚·ãƒ£ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«<code>views/partials/flash.ejs</code>ã¨ã—ã¦ä½œæˆã—ã¾ã—ãŸã€‚
                </p>
                <pre><code class="language-html">&lt;!-- views/partials/flash.ejs --&gt;
&lt;% if(success && success.length) { %&gt;
    &lt;div class="alert alert-success alert-dismissible fade show" role="alert"&gt;
        &lt;%= success %&gt;
        &lt;button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"&gt;&lt;/button&gt;
    &lt;/div&gt;
&lt;% } %&gt;

&lt;% if(error && error.length) { %&gt;
    &lt;div class="alert alert-danger alert-dismissible fade show" role="alert"&gt;
        &lt;%= error %&gt;
        &lt;button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"&gt;&lt;/button&gt;
    &lt;/div&gt;
&lt;% } %&gt;</code></pre>
                <p>
                    ãã—ã¦ã€ã“ã®ãƒ‘ãƒ¼ã‚·ãƒ£ãƒ«ã‚’å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ•ã‚¡ã‚¤ãƒ«<code>views/layouts/boilerplate.ejs</code>ã«çµ„ã¿è¾¼ã‚€ã“ã¨ã§ã€ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã§ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚
                </p>
                <pre><code class="language-html">&lt;!-- views/layouts/boilerplate.ejs --&gt;
&lt;main class="container mt-5"&gt;
    &lt;%- include('../partials/flash') %&gt;
    &lt;%- body %&gt;
&lt;/main&gt;</code></pre>
                <p>
                    ã“ã®æ§‹æˆã«ã‚ˆã‚Šã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ã€Bootstrapã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒé©ç”¨ã•ã‚ŒãŸã‚¢ãƒ©ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
                </p>
            </li>
        </ol>
    </div>

</body>

</html>