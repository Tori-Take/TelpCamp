<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TelpCamp é–‹ç™ºè¨˜éŒ² - Step 29: Passport.jsã«ã‚ˆã‚‹èªè¨¼åŸºç›¤ã®æ§‹ç¯‰</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }

        h1,
        h2,
        h3,
        h4 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px
        }

        h4 {
            border-bottom: none;
            color: #3498db;
        }

        code {
            background-color: #ecf0f1;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        }

        pre {
            background-color: #2c3e50;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        .step {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .concept {
            background-color: #e8f6f3;
            border-left: 5px solid #1abc9c;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>

<body>

    <h1>TelpCamp ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã®è¨˜éŒ²</h1>

    <div class="step">
        <h2>Step 29: Passport.jsã«ã‚ˆã‚‹èªè¨¼åŸºç›¤ã®æ§‹ç¯‰</h2>
        <p>
            ä»¥å‰ã®<code>AuthDemo</code>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯èªè¨¼æ©Ÿèƒ½ã‚’è‡ªå‰ã§å®Ÿè£…ã—ã¾ã—ãŸãŒã€ä»Šå›ã¯ã‚ˆã‚Šå …ç‰¢ã§æ‹¡å¼µæ€§ã®é«˜ã„èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã€Node.jsã®ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã§ã‚ã‚‹<code>Passport.js</code>ã‚’å°å…¥ã—ã¾ã—ãŸã€‚
        </p>

        <h3>å­¦ç¿’ã®ç›®çš„</h3>
        <ul>
            <li><code>passport</code>, <code>passport-local</code>,
                <code>passport-local-mongoose</code>ã®å½¹å‰²ã‚’ç†è§£ã—ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚
            </li>
            <li><code>passport-local-mongoose</code>ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã„ã€Userãƒ¢ãƒ‡ãƒ«ã®å®šç¾©ã‚’å¤§å¹…ã«ç°¡ç•¥åŒ–ã™ã‚‹æ–¹æ³•ã‚’å­¦ã¶ã€‚</li>
            <li>Expressã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«Passportã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’è¨­å®šã—ã€åˆæœŸåŒ–ã™ã‚‹æµã‚Œã‚’ç†è§£ã™ã‚‹ã€‚</li>
            <li>Passportã®ã€Œã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼ï¼ˆæˆ¦ç•¥ï¼‰ã€ã®æ¦‚å¿µã¨ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®ä»•çµ„ã¿ï¼ˆã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºãƒ»ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼‰ã‚’æŠŠæ¡ã™ã‚‹ã€‚</li>
        </ul>
    </div>

    <div class="step">
        <h2>å®Ÿè£…ã®è§£èª¬</h2>
        <p>
            Passportã‚’å°å…¥ã™ã‚‹ãŸã‚ã«ã€é–¢é€£ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€Userãƒ¢ãƒ‡ãƒ«ã®æ›´æ–°ã€ãã—ã¦<code>index.js</code>ã§ã®è¨­å®šã‚’è¡Œã„ã¾ã—ãŸã€‚
        </p>
        <h4>1. é–¢é€£ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h4>
        <p>
            èªè¨¼ã®æ ¸ã¨ãªã‚‹<code>passport</code>ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹èªè¨¼ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«èªè¨¼ï¼‰ã‚’è¡Œã†ãŸã‚ã®<code>passport-local</code>ã€ãã—ã¦Mongooseã¨ã®é€£æºã‚’åŠ‡çš„ã«ç°¡å˜ã«ã™ã‚‹<code>passport-local-mongoose</code>ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚
        </p>
        <pre><code class="language-bash">npm i passport passport-local passport-local-mongoose</code></pre>

        <h4>2. Userãƒ¢ãƒ‡ãƒ«ã®æ›´æ–° (<code>models/user.js</code>)</h4>
        <p>
            <code>passport-local-mongoose</code>ã‚’ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€Userãƒ¢ãƒ‡ãƒ«ã®è¨˜è¿°ãŒéå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚Šã¾ã—ãŸã€‚
        </p>
        <pre><code class="language-javascript">const passportLocalMongoose = require('passport-local-mongoose');

const UserSchema = new Schema({
    email: {
        type: String,
        required: true,
        unique: true
    }
});

UserSchema.plugin(passportLocalMongoose);</code></pre>
        <div class="concept">
            <h4>ğŸ’¡ <code>passport-local-mongoose</code>ã®å¨åŠ›</h4>
            <p>ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ã€ã‚¹ã‚­ãƒ¼ãƒã«<code>username</code>, <code>hash</code>,
                <code>salt</code>ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è‡ªå‹•ã§è¿½åŠ ã—ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–ã‚„æ¯”è¼ƒã¨ã„ã£ãŸé¢å€’ãªå‡¦ç†ã‚’ã™ã¹ã¦è£å´ã§æ‹…ã£ã¦ãã‚Œã¾ã™ã€‚ã•ã‚‰ã«ã€<code>User.register()</code>ã‚„<code>User.authenticate()</code>ã¨ã„ã£ãŸä¾¿åˆ©ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚‚ãƒ¢ãƒ‡ãƒ«ã«è¿½åŠ ã—ã¦ãã‚Œã‚‹ãŸã‚ã€æ‰‹å‹•ã§<code>bcrypt</code>ã‚’æ‰±ã†å¿…è¦ãŒãªããªã‚Šã¾ã—ãŸã€‚
            </p>
        </div>

        <h4>3. Passportã®åˆæœŸè¨­å®š (<code>index.js</code>)</h4>
        <p>
            ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã§PassportãŒæ©Ÿèƒ½ã™ã‚‹ã‚ˆã†ã«ã€ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ã—ã¦è¨­å®šã—ã¾ã—ãŸã€‚ã“ã®è¨­å®šã¯<code>express-session</code>ã®å¾Œã«è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
        </p>
        <pre><code class="language-javascript">// index.js
app.use(passport.initialize());
app.use(passport.session());

passport.use(new LocalStrategy(User.authenticate()));

passport.serializeUser(User.serializeUser());
passport.deserializeUser(User.deserializeUser());</code></pre>
        <div class="concept">
            <h4>ğŸ’¡ Passportã®èªè¨¼ãƒ•ãƒ­ãƒ¼</h4>
            <ul>
                <li><strong><code>passport.initialize()</code> / <code>passport.session()</code></strong>:
                    Passportã‚’èµ·å‹•ã—ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨é€£æºã•ã›ã¾ã™ã€‚</li>
                <li><strong><code>passport.use(...)</code></strong>:
                    Passportã«ã€Œã©ã®ã‚ˆã†ãªæ–¹æ³•ã§èªè¨¼ã‚’è¡Œã†ã‹ï¼ˆã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼ï¼‰ã€ã‚’æ•™ãˆã¾ã™ã€‚ä»Šå›ã¯<code>LocalStrategy</code>ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰ã‚’ä½¿ã„ã€ãã®å…·ä½“çš„ãªèªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã¨ã—ã¦<code>passport-local-mongoose</code>ãŒæä¾›ã™ã‚‹<code>User.authenticate()</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒ‡å®šã—ã¾ã—ãŸã€‚
                </li>
                <li><strong><code>serializeUser</code> / <code>deserializeUser</code></strong>:
                    ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸå¾Œã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã©ã®æƒ…å ±ï¼ˆé€šå¸¸ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼‰ã‚’ä¿å­˜ã™ã‚‹ã‹ï¼ˆã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼‰ã€ãã—ã¦å¾Œç¶šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ã©ã†å¾©å…ƒã™ã‚‹ã‹ï¼ˆãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼‰ã‚’å®šç¾©ã—ã¾ã™ã€‚ã“ã‚Œã‚‚<code>passport-local-mongoose</code>ãŒæä¾›ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ¸¡ã™ã ã‘ã§å®Œäº†ã§ã™ã€‚
                </li>
            </ul>
        </div>
        <p>
            ã“ã‚Œã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã‚„ãƒ­ã‚°ã‚¤ãƒ³ã®ãƒ«ãƒ¼ãƒˆã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚
        </p>
    </div>

</body>

</html>