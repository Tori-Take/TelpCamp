<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TelpCamp é–‹ç™ºè¨˜éŒ² - Step 30: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½ã®å®Ÿè£…</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }

        h1,
        h2,
        h3,
        h4 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px
        }

        h4 {
            border-bottom: none;
            color: #3498db;
        }

        code {
            background-color: #ecf0f1;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        }

        pre {
            background-color: #2c3e50;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        .step {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .concept {
            background-color: #e8f6f3;
            border-left: 5px solid #1abc9c;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>

<body>

    <h1>TelpCamp ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã®è¨˜éŒ²</h1>

    <div class="step">
        <h2>Step 30: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½ã®å®Ÿè£…</h2>
        <p>
            Passportã®èªè¨¼åŸºç›¤ã‚’å…ƒã«ã€å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ç”»é¢ã¨ã€ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚
        </p>
        <h3>å­¦ç¿’ã®ç›®çš„</h3>
        <ul>
            <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ç”¨ã®ãƒ•ã‚©ãƒ¼ãƒ ã¨ã€ãã‚Œã«é–¢é€£ã™ã‚‹ãƒ«ãƒ¼ãƒˆã‚’å°‚ç”¨ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†é›¢ã™ã‚‹ã€‚</li>
            <li><code>passport-local-mongoose</code>ãŒæä¾›ã™ã‚‹<code>User.register(user, password)</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã„ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç™»éŒ²å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã€‚
            </li>
            <li>ç™»éŒ²å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åã®é‡è¤‡ãªã©ï¼‰ãŒç™ºç”Ÿã—ãŸå ´åˆã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ–¹æ³•ã‚’å­¦ã¶ (<code>try...catch</code>)ã€‚</li>
            <li>ç™»éŒ²æˆåŠŸå¾Œã€<code>req.login()</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è‡ªå‹•çš„ã«ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã«ã™ã‚‹æ–¹æ³•ã‚’ç¿’å¾—ã™ã‚‹ã€‚</li>
            <li><code>connect-flash</code>ã‚’ä½¿ã„ã€ç™»éŒ²ã®æˆåŠŸãƒ»å¤±æ•—ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã™ã‚‹ã€‚</li>
        </ul>
    </div>

    <div class="step">
        <h2>å®Ÿè£…ã®è§£èª¬</h2>
        <p>
            ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£ã®ãƒ«ãƒ¼ãƒˆã‚’ã¾ã¨ã‚ã‚‹ãŸã‚ã€æ–°ã—ã<code>routes/users.js</code>ã‚’ä½œæˆã—ã€ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã®è¡¨ç¤ºã¨ç™»éŒ²å‡¦ç†ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚
        </p>
        <h4>1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã®ä½œæˆ (<code>views/users/register.ejs</code>)</h4>
        <p>
            ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã—ã¾ã—ãŸã€‚Bootstrapã®ã‚¯ãƒ©ã‚¹ã‚’ä½¿ã£ã¦ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚è¨­å®šã—ã¦ã„ã¾ã™ã€‚
        </p>
        <pre><code class="language-html">&lt;% layout('layouts/boilerplate') %&gt;

&lt;h1&gt;ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²&lt;/h1&gt;
&lt;form action="/register" method="POST" class="validated-form" novalidate&gt;
    &lt;div class="mb-3"&gt;
        &lt;label class="form-label" for="username"&gt;ãƒ¦ãƒ¼ã‚¶ãƒ¼å&lt;/label&gt;
        &lt;input class="form-control" type="text" id="username" name="username" required&gt;
    &lt;/div&gt;
    &lt;!-- email, passwordã®å…¥åŠ›æ¬„ ... --&gt;
    &lt;button class="btn btn-success"&gt;ç™»éŒ²&lt;/button&gt;
&lt;/form&gt;</code></pre>

        <h4>2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ«ãƒ¼ãƒˆã®ä½œæˆ (<code>routes/users.js</code>)</h4>
        <p>
            ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤ºã™ã‚‹GETãƒ«ãƒ¼ãƒˆã¨ã€ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã£ã¦å‡¦ç†ã™ã‚‹POSTãƒ«ãƒ¼ãƒˆã‚’å®šç¾©ã—ã¾ã—ãŸã€‚
        </p>
        <pre><code class="language-javascript">router.post('/register', catchAsync(async (req, res, next) => {
    try {
        const { email, username, password } = req.body;
        const user = new User({ email, username });
        // User.registerã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç™»éŒ²
        const registeredUser = await User.register(user, password);
        // req.loginã§è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³
        req.login(registeredUser, err => {
            if (err) return next(err);
            req.flash('success', 'TelpCampã¸ã‚ˆã†ã“ãï¼');
            res.redirect('/campgrounds');
        });
    } catch (e) {
        req.flash('error', e.message);
        res.redirect('/register');
    }
}));</code></pre>
        <div class="concept">
            <h4>ğŸ’¡ <code>User.register()</code>ã¨<code>req.login()</code></h4>
            <ul>
                <li><strong><code>User.register(user, password)</code></strong>:
                    <code>passport-local-mongoose</code>ãŒæä¾›ã™ã‚‹ä¸­å¿ƒçš„ãªãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨å¹³æ–‡ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¸¡ã™ã¨ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–ã¨ã‚½ãƒ«ãƒˆã®ç”Ÿæˆã€ãã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ä¿å­˜ã¾ã§ã‚’ã™ã¹ã¦è¡Œã£ã¦ãã‚Œã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŒæ—¢ã«å­˜åœ¨ã™ã‚‹å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¾ã™ã€‚
                </li>
                <li><strong><code>req.login(user, callback)</code></strong>:
                    PassportãŒ<code>req</code>ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«è¿½åŠ ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãŒæˆåŠŸã—ãŸç›´å¾Œã«ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã«ã—ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç¢ºç«‹ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç™»éŒ²å¾Œã«å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹æ‰‹é–“ãŒçœã‘ã¾ã™ã€‚
                </li>
            </ul>
        </div>

        <h4>3. ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã®ç™»éŒ² (<code>index.js</code>)</h4>
        <p>
            ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚‹<code>index.js</code>ã«ç™»éŒ²ã—ã¾ã—ãŸã€‚
        </p>
        <pre><code class="language-javascript">const userRoutes = require('./routes/users');
// ...
app.use('/', userRoutes);</code></pre>
        <p>
            ã“ã‚Œã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯<code>/register</code>ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦æ–°ã—ã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
        </p>
    </div>

</body>

</html>