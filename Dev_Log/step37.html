<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TelpCamp é–‹ç™ºè¨˜éŒ² - Step 37: ã‚­ãƒ£ãƒ³ãƒ—å ´ã®èªå¯ï¼ˆæ‰€æœ‰æ¨©ï¼‰</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }

        h1,
        h2,
        h3,
        h4 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px
        }

        h4 {
            border-bottom: none;
            color: #3498db;
        }

        code {
            background-color: #ecf0f1;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        }

        pre {
            background-color: #2c3e50;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        .step {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .concept {
            background-color: #e8f6f3;
            border-left: 5px solid #1abc9c;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>

<body>

    <h1>TelpCamp ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã®è¨˜éŒ²</h1>

    <div class="step">
        <h2>Step 37: ã‚­ãƒ£ãƒ³ãƒ—å ´ã®èªå¯ï¼ˆæ‰€æœ‰æ¨©ï¼‰</h2>
        <p>
            ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ã•ã‚‰ã«å¼·åŒ–ã™ã‚‹ãŸã‚ã€ã‚­ãƒ£ãƒ³ãƒ—å ´ã®ç·¨é›†ãƒ»å‰Šé™¤ã¨ã„ã£ãŸç ´å£Šçš„ãªæ“ä½œã‚’ã€ãã®ã‚­ãƒ£ãƒ³ãƒ—å ´ã‚’ç™»éŒ²ã—ãŸæœ¬äººï¼ˆæ‰€æœ‰è€…ï¼‰ã®ã¿ã«è¨±å¯ã™ã‚‹èªå¯æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚
        </p>
        <h3>å­¦ç¿’ã®ç›®çš„</h3>
        <ul>
            <li>æ‰€æœ‰è€…ãƒ™ãƒ¼ã‚¹ã®èªå¯ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã‚’å­¦ã¶ã€‚</li>
            <li>Mongooseã®<code>.equals()</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã„ã€ObjectIdã‚’æ­£ã—ãæ¯”è¼ƒã™ã‚‹æ–¹æ³•ã‚’ç¿’å¾—ã™ã‚‹ã€‚</li>
            <li>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ï¼ˆãƒ“ãƒ¥ãƒ¼ï¼‰ã¨ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ï¼ˆãƒ«ãƒ¼ãƒˆï¼‰ã®ä¸¡æ–¹ã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’è¡Œã†ã€äºŒæ®µæ§‹ãˆã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…ã‚’ç†è§£ã™ã‚‹ã€‚</li>
        </ul>
    </div>

    <div class="step">
        <h2>å®Ÿè£…ã®è§£èª¬</h2>
        <p>
            æ‰€æœ‰è€…ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ä½œæˆã—ã€ãã‚Œã‚’ãƒ«ãƒ¼ãƒˆã¨ãƒ“ãƒ¥ãƒ¼ã®ä¸¡æ–¹ã«é©ç”¨ã—ã¾ã—ãŸã€‚
        </p>
        <h4>1. èªå¯ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®ä½œæˆ (<code>middleware.js</code>)</h4>
        <p>
            ã‚­ãƒ£ãƒ³ãƒ—å ´ã®æ‰€æœ‰è€…ã¨ç¾åœ¨ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸€è‡´ã™ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹<code>isAuthor</code>ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ä½œæˆã—ã¾ã—ãŸã€‚
        </p>
        <pre><code class="language-javascript">// middleware.js
const Campground = require('./models/campground');

module.exports.isAuthor = async (req, res, next) => {
    const { id } = req.params;
    const campground = await Campground.findById(id);
    // ã‚­ãƒ£ãƒ³ãƒ—å ´ã®æ‰€æœ‰è€…ã¨ã€ç¾åœ¨ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸€è‡´ã—ãªã„å ´åˆ
    if (!campground.author.equals(req.user._id)) {
        req.flash('error', 'ãã®æ“ä½œã‚’è¡Œã†æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return res.redirect(`/campgrounds/${id}`);
    }
    next();
}</code></pre>
        <div class="concept">
            <h4>ğŸ’¡ ObjectIdã®æ¯”è¼ƒ</h4>
            <p><code>campground.author</code>ã¨<code>req.user._id</code>ã¯ã©ã¡ã‚‰ã‚‚Mongooseã®ObjectIdã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚ã“ã‚Œã‚‰ã‚’JavaScriptã®å³å¯†ç­‰ä¾¡æ¼”ç®—å­ï¼ˆ<code>===</code>ï¼‰ã§æ¯”è¼ƒã™ã‚‹ã¨ã€å‚ç…§å…ˆãŒç•°ãªã‚‹ãŸã‚å¸¸ã«<code>false</code>ã«ãªã‚Šã¾ã™ã€‚ObjectIdã®å€¤ã‚’æ¯”è¼ƒã™ã‚‹ã«ã¯ã€MongooseãŒæä¾›ã™ã‚‹<code>.equals()</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
            </p>
        </div>

        <h4>2. ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®èªå¯ (<code>routes/campgrounds.js</code>)</h4>
        <p>
            ä½œæˆã—ãŸ<code>isAuthor</code>ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ã€ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã®è¡¨ç¤ºï¼ˆGETï¼‰ã€æ›´æ–°ï¼ˆPUTï¼‰ã€å‰Šé™¤ï¼ˆDELETEï¼‰ã®å„ãƒ«ãƒ¼ãƒˆã«é©ç”¨ã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€URLã‚’ç›´æ¥æ“ä½œã™ã‚‹ãªã©ã®ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚µãƒ¼ãƒãƒ¼å´ã§ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã™ã€‚
        </p>
        <pre><code class="language-javascript">// routes/campgrounds.js
const { isLoggedIn, isAuthor } = require('../middleware');

router.get('/:id/edit', isLoggedIn, isAuthor, ...);
router.put('/:id', isLoggedIn, isAuthor, ...);
router.delete('/:id', isLoggedIn, isAuthor, ...);</code></pre>

        <h4>3. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã®èªå¯ (<code>views/campgrounds/show.ejs</code>)</h4>
        <p>
            ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã€ãã‚‚ãã‚‚æ¨©é™ã®ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ã€Œç·¨é›†ã€ã€Œå‰Šé™¤ã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„ã‚ˆã†ã«ã€ãƒ“ãƒ¥ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ã—ã¾ã—ãŸã€‚
        </p>
        <pre><code class="language-html">&lt;% if(currentUser && campground.author.equals(currentUser._id)) { %&gt;
    &lt;a href="/campgrounds/&lt;%= campground._id %&gt;/edit" class="card-link btn btn-info"&gt;ç·¨é›†&lt;/a&gt;
    &lt;form ...&gt;
        &lt;button class="btn btn-danger"&gt;å‰Šé™¤&lt;/button&gt;
    &lt;/form&gt;
&lt;% } %&gt;</code></pre>
        <p>
            ã“ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¨ã‚µãƒ¼ãƒãƒ¼å´ã®äºŒé‡ã®ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚Šã€å …ç‰¢ã§å®‰å…¨ãªèªå¯ã‚·ã‚¹ãƒ†ãƒ ãŒå®Œæˆã—ã¾ã—ãŸã€‚
        </p>
    </div>

</body>

</html>