<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TelpCamp é–‹ç™ºè¨˜éŒ² - Step 39: MVCã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¸ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }

        h1,
        h2,
        h3,
        h4 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px
        }

        h4 {
            border-bottom: none;
            color: #3498db;
        }

        code {
            background-color: #ecf0f1;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        }

        pre {
            background-color: #2c3e50;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        .step {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .concept {
            background-color: #e8f6f3;
            border-left: 5px solid #1abc9c;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>

<body>

    <h1>TelpCamp ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã®è¨˜éŒ²</h1>

    <div class="step">
        <h2>Step 39: MVCã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¸ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° - ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®å°å…¥</h2>
        <p>
            ã“ã‚Œã¾ã§ã€ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ<code>routes/*.js</code>ï¼‰ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®å®šç¾©ã¨ã€ãã®ãƒ«ãƒ¼ãƒˆãŒå®Ÿè¡Œã™ã‚‹å…·ä½“çš„ãªå‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ãŒæ··åœ¨ã—ã¦ã„ã¾ã—ãŸã€‚
            ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæˆé•·ã™ã‚‹ã«ã¤ã‚Œã¦ã€ã“ã®æ§‹é€ ã¯å¯èª­æ€§ã¨ä¿å®ˆæ€§ã‚’æãªã†åŸå› ã¨ãªã‚Šã¾ã™ã€‚
            ãã“ã§ä»Šå›ã¯ã€MVC (Model-View-Controller) ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è€ƒãˆæ–¹ã«åŸºã¥ãã€å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã€Œã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã€ã¨ã—ã¦åˆ†é›¢ã™ã‚‹å¤§è¦æ¨¡ãªãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã„ã¾ã—ãŸã€‚
        </p>
        <h3>å­¦ç¿’ã®ç›®çš„</h3>
        <ul>
            <li>MVCã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã‘ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®å½¹å‰²ã‚’ç†è§£ã™ã‚‹ã€‚</li>
            <li>ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢ã—ã€ã‚³ãƒ¼ãƒ‰ã®ã€Œé–¢å¿ƒã®åˆ†é›¢ã€ã‚’å®Ÿè·µã™ã‚‹ã€‚</li>
            <li><code>router.route()</code>ã‚’ä½¿ã„ã€åŒã˜ãƒ‘ã‚¹ã«å¯¾ã™ã‚‹è¤‡æ•°ã®ãƒ«ãƒ¼ãƒˆå®šç¾©ã‚’ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã—ã¦å¯èª­æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã€‚</li>
            <li>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®æ§‹é€ ã‚’æ•´ç†ã—ã€å°†æ¥ã®æ©Ÿèƒ½è¿½åŠ ã‚„ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’å®¹æ˜“ã«ã™ã‚‹ã€‚</li>
        </ul>
    </div>

    <div class="step">
        <h2>å®Ÿè£…ã®è§£èª¬</h2>
        <p>
            ã‚­ãƒ£ãƒ³ãƒ—å ´ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆã«å¯¾ã—ã¦ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¸ã®åˆ†é›¢ã¨ãƒ«ãƒ¼ãƒˆã®ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã‚’é©ç”¨ã—ã¾ã—ãŸã€‚
        </p>
        <ol>
            <li>
                <h4>1. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ä½œæˆã¨ãƒ­ã‚¸ãƒƒã‚¯ã®ç§»è¡Œ</h4>
                <p>
                    ã¾ãšã€<code>controllers</code>ã¨ã„ã†æ–°ã—ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ãã®ä¸­ã«<code>campgrounds.js</code>,
                    <code>reviews.js</code>, <code>users.js</code>ã‚’è¨­ç½®ã—ã¾ã—ãŸã€‚
                    ãã—ã¦ã€å„ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¿°ã•ã‚Œã¦ã„ãŸå‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ï¼‰ã‚’ã€å¯¾å¿œã™ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢æ•°ã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹å½¢ã§ç§»è¡Œã—ã¾ã—ãŸã€‚
                </p>
                <p><b><code>controllers/campgrounds.js</code> ã®ä¾‹</b></p>
                <pre><code class="language-javascript">const Campground = require('../models/campground');

module.exports.createCampground = async (req, res, next) => {
    const campground = new Campground(req.body.campground);
    campground.author = req.user._id;
    await campground.save();
    req.flash('success', 'æ–°ã—ã„ã‚­ãƒ£ãƒ³ãƒ—å ´ã‚’ä½œæˆã—ã¾ã—ãŸã€‚');
    res.redirect(`/campgrounds/${campground._id}`);
};</code></pre>
                <p>
                    ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å´ã§ã¯ã€ã“ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼é–¢æ•°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦å‘¼ã³å‡ºã™ã ã‘ã®ã‚·ãƒ³ãƒ—ãƒ«ãªè¨˜è¿°ã«ãªã‚Šã¾ã—ãŸã€‚
                </p>
                <p><b><code>routes/campgrounds.js</code> ã®å¤‰æ›´å¾Œ</b></p>
                <pre><code class="language-javascript">const campgroundsController = require('../controllers/campgrounds');

// ...
router.post('/', isLoggedIn, validateCampground, wrapAsync(campgroundsController.createCampground));</code></pre>
                <div class="concept">
                    <h4>ğŸ’¡ é–¢å¿ƒã®åˆ†é›¢ (Separation of Concerns)</h4>
                    <p>
                        ã“ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®æ ¸å¿ƒã¯ã€Œé–¢å¿ƒã®åˆ†é›¢ã€ã§ã™ã€‚
                    </p>
                    <ul>
                        <li><b>Routes</b>: ã©ã®URLãƒ‘ã‚¹ãŒã€ã©ã®HTTPãƒ¡ã‚½ãƒƒãƒ‰ã§ã€ã©ã®å‡¦ç†ã«ç¹‹ãŒã‚‹ã‹ã¨ã„ã†ã€Œäº¤é€šæ•´ç†ã€ã«å°‚å¿µã™ã‚‹ã€‚</li>
                        <li><b>Controllers</b>: å®Ÿéš›ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã—ã€ãƒ¢ãƒ‡ãƒ«ã¨ã‚„ã‚Šå–ã‚Šã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã¨ã„ã†ã€Œå®Ÿå‹™ã€ã«å°‚å¿µã™ã‚‹ã€‚</li>
                    </ul>
                    <p>
                        å½¹å‰²åˆ†æ‹…ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ãŒã©ã“ã«ã‚ã‚‹ã‹ã‚’è¦‹ã¤ã‘ã‚„ã™ããªã‚Šã€å¤‰æ›´ã‚„ãƒ‡ãƒãƒƒã‚°ãŒæ ¼æ®µã«å®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚
                    </p>
                </div>
            </li>
            <li>
                <h4>2. ãƒ«ãƒ¼ãƒˆã®ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚° (<code>router.route()</code>)</h4>
                <p>
                    åŒã˜ãƒ‘ã‚¹ã«å¯¾ã—ã¦ã€ç•°ãªã‚‹HTTPãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆä¾‹:
                    <code>GET</code>ã¨<code>POST</code>ï¼‰ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ãƒ«ãƒ¼ãƒˆã‚’ã€<code>router.route()</code>ã‚’ä½¿ã£ã¦ä¸€ã¤ã«ã¾ã¨ã‚ã¾ã—ãŸã€‚
                </p>
                <pre><code class="language-javascript">// routes/campgrounds.js

// å¤‰æ›´å‰
// router.get('/', wrapAsync(campgroundsController.index));
// router.post('/', isLoggedIn, validateCampground, wrapAsync(campgroundsController.createCampground));

// å¤‰æ›´å¾Œ
router.route('/')
    .get(wrapAsync(campgroundsController.index))
    .post(isLoggedIn, validateCampground, wrapAsync(campgroundsController.createCampground));


// å¤‰æ›´å‰
// router.get('/:id', wrapAsync(campgroundsController.showCampground));
// router.put('/:id', isLoggedIn, isAuthor, validateCampground, wrapAsync(campgroundsController.updateCampground));
// router.delete('/:id', isLoggedIn, isAuthor, wrapAsync(campgroundsController.deleteCampground));

// å¤‰æ›´å¾Œ
router.route('/:id')
    .get(wrapAsync(campgroundsController.showCampground))
    .put(isLoggedIn, isAuthor, validateCampground, wrapAsync(campgroundsController.updateCampground))
    .delete(isLoggedIn, isAuthor, wrapAsync(campgroundsController.deleteCampground));</code></pre>
                <p>
                    ã“ã‚Œã«ã‚ˆã‚Šã€ã©ã®ãƒ‘ã‚¹ãŒã©ã®ã‚ˆã†ãªæ“ä½œã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã‹ãŒä¸€ç›®ç­ç„¶ã«ãªã‚Šã€ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å¯èª­æ€§ãŒã•ã‚‰ã«å‘ä¸Šã—ã¾ã—ãŸã€‚
                </p>
            </li>
        </ol>
    </div>

</body>

</html>