<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TelpCamp プロジェクト作成の記録 - Step 7</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }

        h1,
        h2,
        h3 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        code {
            background-color: #ecf0f1;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        }

        pre {
            background-color: #2c3e50;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        .step {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .concept {
            background-color: #e8f6f3;
            border-left: 5px solid #1abc9c;
            padding: 15px;
            margin: 20px 0;
        }

        li {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>

    <h1>TelpCamp プロジェクト作成の記録</h1>

    <div class="step">
        <h2>学習の目的</h2>
        <p>
            このステップでは、<strong>ejs-mate</strong>というパッケージを導入し、EJSのテンプレート機能を拡張します。
            複数のページで共通するヘッダーやフッターなどのレイアウトを一つのファイルにまとめることで、コードの重複をなくし、メンテナンス性を向上させることが目的です。
        </p>
        <ul>
            <li><code>ejs-mate</code>をインストールし、Expressアプリケーションに設定する方法を学ぶ。</li>
            <li>共通のレイアウトファイル（ボイラープレート）を作成し、その中でコンテンツを埋め込む方法（<code>&lt;%- body %&gt;</code>）を理解する。</li>
            <li>個別のビューファイルからレイアウトファイルを呼び出す方法（<code>&lt;% layout(...) %&gt;</code>）を習得する。</li>
            <li><code>app.engine()</code>と<code>app.set('view engine', ...)</code>の違いと役割を理解する。</li>
        </ul>
    </div>

    <div class="step">
        <h2>ステップ7: ejs-mateによるレイアウトの共通化</h2>
        <p>各ページのEJSファイルに共通して記述されている<code>&lt;html&gt;</code>や<code>&lt;body&gt;</code>タグなどを、一つの共通レイアウトファイルにまとめます。</p>
        <ol>
            <li>
                <strong>ejs-mateのインストール:</strong>
                <p>まず、ターミナルで<code>ejs-mate</code>パッケージをインストールします。</p>
                <pre><code>npm install ejs-mate</code></pre>
            </li>
            <li>
                <strong>Expressの設定変更 (<code>index.js</code>):</strong>
                <p>Expressに、EJSファイルを処理するエンジンとして<code>ejs-mate</code>を使用するよう設定します。</p>
                <pre><code>const ejsMate = require('ejs-mate');
// ...
app.engine('ejs', ejsMate);
app.set('view engine', 'ejs');</code></pre>
                <div class="concept">
                    <h4>💡 <code>app.engine()</code> vs <code>app.set()</code></h4>
                    <p>この2行は協力して動作します。</p>
                    <ul>
                        <li><code>app.set('view engine', 'ejs')</code>:
                            「このアプリのテンプレートエンジンは'ejs'です」と<strong>宣言</strong>します。これにより<code>res.render()</code>で拡張子を省略できます。
                        </li>
                        <li><code>app.engine('ejs', ejsMate)</code>:
                            「'ejs'エンジンが呼ばれたら、実際には<code>ejs-mate</code>の機能を使って処理してください」と、エンジンの具体的な動作を<strong>定義（上書き）</strong>します。
                        </li>
                    </ul>
                    <p>この設定により、Expressの便利な機能を維持しつつ、エンジンの心臓部だけを<code>ejs-mate</code>に入れ替えることができます。</p>
                </div>
            </li>
            <li>
                <strong>レイアウトファイルの作成 (<code>views/layouts/boilerplate.ejs</code>):</strong>
                <p>すべてのページの「骨組み」となるファイルを作成します。<code>views</code>フォルダ内に<code>layouts</code>フォルダを新規作成し、その中に<code>boilerplate.ejs</code>を作成します。
                </p>
                <pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;TelpCamp&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;!-- この部分に各ページのコンテンツが挿入されます --&gt;
    &lt;%- body %&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                <div class="concept">
                    <h4>💡 <code>boilerplate</code>と<code>&lt;%- body %&gt;</code></h4>
                    <ul>
                        <li><strong>boilerplate (ボイラープレート):</strong>
                            プログラミングの世界で「雛形」や「定型文」を意味する言葉です。このファイルがサイト全体の雛形となります。</li>
                        <li><strong><code>&lt;%- body %&gt;</code>:</strong>
                            <code>ejs-mate</code>の特別な記述で、この場所に各ページの個別のコンテンツが自動的に挿入されます。</li>
                    </ul>
                </div>
            </li>
            <li>
                <strong>既存ビューの修正:</strong>
                <p>最後に、<code>index.ejs</code>や<code>show.ejs</code>などの既存のEJSファイルから共通部分を削除し、先頭でレイアウトファイルを指定するように修正します。
                </p>
                <p><strong>修正前 (例: <code>index.ejs</code>)</strong></p>
                <pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;...&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;すべてのキャンプ場&lt;/h1&gt;
    ...
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                <p><strong>修正後 (例: <code>index.ejs</code>)</strong></p>
                <pre><code>&lt;% layout('layouts/boilerplate') %&gt;
&lt;h1&gt;すべてのキャンプ場&lt;/h1&gt;
...</code></pre>
                <p><code>&lt;% layout(...) %&gt;</code>という記述が、「このファイルの内容を、指定したレイアウトファイルの<code>&lt;%- body %&gt;</code>の部分に埋め込んでください」という<code>ejs-mate</code>への指示になります。
                </p>
            </li>
            <li>
                <strong>動作確認:</strong>
                <p>サーバーを再起動し、各ページにアクセスします。見た目は変わらないままですが、コードの重複がなくなり、管理が非常に楽になっていることを確認します。例えば、全ページのタイトルを一度に変更したい場合、<code>boilerplate.ejs</code>の<code>&lt;title&gt;</code>タグを修正するだけで済みます。
                </p>
            </li>
        </ol>
    </div>

</body>

</html>